# Шаблон отладки

Шаблон для `.planning/debug/[slug].md` — отслеживание активной сессии отладки.

---

## Шаблон файла

```markdown
---
status: gathering | investigating | fixing | verifying | resolved
trigger: "[дословный ввод пользователя]"
created: [ISO метка времени]
updated: [ISO метка времени]
---

## Текущий фокус
<!-- ПЕРЕЗАПИСЫВАТЬ при каждом обновлении — всегда отражает СЕЙЧАС -->

hypothesis: [текущая теория, которая проверяется]
test: [как проверяется]
expecting: [что означает результат, если теория верна/неверна]
next_action: [ближайший следующий шаг]

## Симптомы
<!-- Записываются во время сбора, затем неизменяемы -->

expected: [что должно происходить]
actual: [что происходит на самом деле]
errors: [сообщения об ошибках, если есть]
reproduction: [как воспроизвести]
started: [когда сломалось / было всегда сломано]

## Исключено
<!-- Только ДОБАВЛЕНИЕ — предотвращает повторное исследование после /clear -->

- hypothesis: [теория, которая оказалась неверной]
  evidence: [что её опровергло]
  timestamp: [когда исключена]

## Доказательства
<!-- Только ДОБАВЛЕНИЕ — факты, обнаруженные в ходе исследования -->

- timestamp: [когда найдено]
  checked: [что было проверено]
  found: [что было обнаружено]
  implication: [что это означает]

## Решение
<!-- ПЕРЕЗАПИСЫВАТЬ по мере развития понимания -->

root_cause: [пусто до обнаружения]
fix: [пусто до применения]
verification: [пусто до проверки]
files_changed: []
```

---

<section_rules>

**Метаданные (status, trigger, timestamps):**
- `status`: ПЕРЕЗАПИСЫВАТЬ — отражает текущую фазу
- `trigger`: НЕИЗМЕНЯЕМЫЙ — дословный ввод пользователя, никогда не меняется
- `created`: НЕИЗМЕНЯЕМЫЙ — устанавливается один раз
- `updated`: ПЕРЕЗАПИСЫВАТЬ — обновлять при каждом изменении

**Текущий фокус:**
- ПЕРЕЗАПИСЫВАТЬ целиком при каждом обновлении
- Всегда отражает, что Claude делает ПРЯМО СЕЙЧАС
- Если Claude читает это после /clear, он точно знает, где продолжить
- Поля: hypothesis, test, expecting, next_action

**Симптомы:**
- Записываются во время начальной фазы сбора информации
- НЕИЗМЕНЯЕМЫ после завершения сбора
- Точка отсчёта для того, что мы пытаемся исправить
- Поля: expected, actual, errors, reproduction, started

**Исключено:**
- Только ДОБАВЛЕНИЕ — никогда не удалять записи
- Предотвращает повторное исследование тупиковых путей после сброса контекста
- Каждая запись: гипотеза, доказательство её несостоятельности, метка времени
- Критически важно для эффективности через границы /clear

**Доказательства:**
- Только ДОБАВЛЕНИЕ — никогда не удалять записи
- Факты, обнаруженные в ходе исследования
- Каждая запись: метка времени, что проверено, что найдено, следствие
- Формирует обоснование для корневой причины

**Решение:**
- ПЕРЕЗАПИСЫВАТЬ по мере развития понимания
- Может обновляться несколько раз по мере попыток исправления
- Финальное состояние показывает подтверждённую корневую причину и проверенное исправление
- Поля: root_cause, fix, verification, files_changed

</section_rules>

<lifecycle>

**Создание:** Немедленно при вызове /gsd:debug
- Создать файл с trigger из ввода пользователя
- Установить status в "gathering"
- Текущий фокус: next_action = "собрать симптомы"
- Симптомы: пусто, заполнить

**Во время сбора симптомов:**
- Обновлять секцию Симптомы по мере ответов пользователя
- Обновлять Текущий фокус с каждым вопросом
- По завершении: status → "investigating"

**Во время исследования:**
- ПЕРЕЗАПИСЫВАТЬ Текущий фокус с каждой гипотезой
- ДОБАВЛЯТЬ в Доказательства с каждой находкой
- ДОБАВЛЯТЬ в Исключено, когда гипотеза опровергнута
- Обновлять метку времени в метаданных

**Во время исправления:**
- status → "fixing"
- Обновить Resolution.root_cause при подтверждении
- Обновить Resolution.fix при применении
- Обновить Resolution.files_changed

**Во время проверки:**
- status → "verifying"
- Обновить Resolution.verification с результатами
- Если проверка провалилась: status → "investigating", попробовать снова

**При решении:**
- status → "resolved"
- Переместить файл в .planning/debug/resolved/

</lifecycle>

<resume_behavior>

Когда Claude читает этот файл после /clear:

1. Разобрать метаданные → узнать статус
2. Прочитать Текущий фокус → точно знать, что происходило
3. Прочитать Исключено → знать, что НЕ нужно повторять
4. Прочитать Доказательства → знать, что уже выяснено
5. Продолжить с next_action

Файл И ЕСТЬ мозг отладки. Claude должен уметь идеально продолжить с любой точки прерывания.

</resume_behavior>

<size_constraint>

Держите файлы отладки сфокусированными:
- Записи доказательств: 1-2 строки каждая, только факты
- Исключено: кратко — гипотеза + почему не подтвердилась
- Никакой повествовательной прозы — только структурированные данные

Если доказательства сильно разрастаются (10+ записей), подумайте, не ходите ли вы по кругу. Проверьте Исключено, чтобы убедиться, что не повторяете пройденное.

</size_constraint>
