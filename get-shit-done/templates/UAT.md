# Шаблон ПАТ (Пользовательское Приёмочное Тестирование)

Шаблон для `.planning/phases/XX-name/{phase}-UAT.md` — постоянное отслеживание сессии ПАТ.

---

## Шаблон файла

```markdown
---
status: testing | complete | diagnosed
phase: XX-name
source: [список протестированных файлов SUMMARY.md]
started: [ISO метка времени]
updated: [ISO метка времени]
---

## Текущий тест
<!-- ПЕРЕЗАПИСЫВАТЬ каждый тест — показывает, где мы находимся -->

number: [N]
name: [название теста]
expected: |
  [что пользователь должен наблюдать]
awaiting: ответ пользователя

## Тесты

### 1. [Название теста]
expected: [наблюдаемое поведение — что пользователь должен видеть]
result: [ожидает]

### 2. [Название теста]
expected: [наблюдаемое поведение]
result: pass

### 3. [Название теста]
expected: [наблюдаемое поведение]
result: issue
reported: "[дословный ответ пользователя]"
severity: major

### 4. [Название теста]
expected: [наблюдаемое поведение]
result: skipped
reason: [почему пропущен]

...

## Итого

total: [N]
passed: [N]
issues: [N]
pending: [N]
skipped: [N]

## Пробелы

<!-- YAML формат для потребления plan-phase --gaps -->
- truth: "[ожидаемое поведение из теста]"
  status: failed
  reason: "Пользователь сообщил: [дословный ответ]"
  severity: blocker | major | minor | cosmetic
  test: [N]
  root_cause: ""     # Заполняется диагностикой
  artifacts: []      # Заполняется диагностикой
  missing: []        # Заполняется диагностикой
  debug_session: ""  # Заполняется диагностикой
```

---

<section_rules>

**Метаданные:**
- `status`: ПЕРЕЗАПИСЫВАТЬ — "testing" или "complete"
- `phase`: НЕИЗМЕНЯЕМЫЙ — устанавливается при создании
- `source`: НЕИЗМЕНЯЕМЫЙ — тестируемые файлы SUMMARY
- `started`: НЕИЗМЕНЯЕМЫЙ — устанавливается при создании
- `updated`: ПЕРЕЗАПИСЫВАТЬ — обновлять при каждом изменении

**Текущий тест:**
- ПЕРЕЗАПИСЫВАТЬ целиком при переходе к каждому тесту
- Показывает, какой тест активен и что ожидается
- По завершении: "[тестирование завершено]"

**Тесты:**
- Каждый тест: ПЕРЕЗАПИСЫВАТЬ поле result при ответе пользователя
- Значения `result`: [ожидает], pass, issue, skipped
- Если issue: добавить `reported` (дословно) и `severity` (определяется автоматически)
- Если skipped: добавить `reason`, если указана

**Итого:**
- ПЕРЕЗАПИСЫВАТЬ счётчики после каждого ответа
- Отслеживает: total, passed, issues, pending, skipped

**Пробелы:**
- Только ДОБАВЛЕНИЕ при обнаружении проблемы (YAML формат)
- После диагностики: заполнить `root_cause`, `artifacts`, `missing`, `debug_session`
- Эта секция напрямую подаётся в /gsd:plan-phase --gaps

</section_rules>

<diagnosis_lifecycle>

**После завершения тестирования (status: complete), если есть пробелы:**

1. Пользователь запускает диагностику (по предложению verify-work или вручную)
2. Рабочий процесс diagnose-issues запускает параллельных агентов отладки
3. Каждый агент исследует один пробел, возвращает корневую причину
4. Секция Пробелы в UAT.md обновляется результатами диагностики:
   - Для каждого пробела заполняются `root_cause`, `artifacts`, `missing`, `debug_session`
5. status → "diagnosed"
6. Готово для /gsd:plan-phase --gaps с корневыми причинами

**После диагностики:**
```yaml
## Пробелы

- truth: "Комментарий появляется сразу после отправки"
  status: failed
  reason: "Пользователь сообщил: работает, но не показывается пока не обновлю страницу"
  severity: major
  test: 2
  root_cause: "useEffect в CommentList.tsx не содержит commentCount в зависимостях"
  artifacts:
    - path: "src/components/CommentList.tsx"
      issue: "Отсутствует зависимость в useEffect"
  missing:
    - "Добавить commentCount в массив зависимостей useEffect"
  debug_session: ".planning/debug/comment-not-refreshing.md"
```

</diagnosis_lifecycle>

<lifecycle>

**Создание:** Когда /gsd:verify-work начинает новую сессию
- Извлечь тесты из файлов SUMMARY.md
- Установить status в "testing"
- Текущий тест указывает на тест 1
- Все тесты имеют result: [ожидает]

**Во время тестирования:**
- Представить тест из секции Текущий тест
- Пользователь отвечает подтверждением прохождения или описанием проблемы
- Обновить result теста (pass/issue/skipped)
- Обновить счётчики Итого
- Если issue: добавить в секцию Пробелы (YAML формат), определить severity
- Переместить Текущий тест к следующему ожидающему тесту

**По завершении:**
- status → "complete"
- Текущий тест → "[тестирование завершено]"
- Закоммитить файл
- Представить итоги со следующими шагами

**Возобновление после /clear:**
1. Прочитать метаданные → узнать фазу и статус
2. Прочитать Текущий тест → узнать, где мы
3. Найти первый результат [ожидает] → продолжить оттуда
4. Итого показывает прогресс

</lifecycle>

<severity_guide>

Серьёзность ОПРЕДЕЛЯЕТСЯ из естественного языка пользователя, никогда не спрашивается.

| Пользователь описывает | Определить как |
|-------------------------|----------------|
| Крах, ошибка, исключение, полностью не работает, непригодно | blocker |
| Не работает, ничего не происходит, неправильное поведение, отсутствует | major |
| Работает, но..., медленно, странно, мелочь, небольшая проблема | minor |
| Цвет, шрифт, отступы, выравнивание, визуально, выглядит не так | cosmetic |

По умолчанию: **major** (безопасное значение, пользователь может уточнить)

</severity_guide>
